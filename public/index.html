<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Socket.IO chat</title>
    <style>
        body {
            margin: 0;
            padding-bottom: 3rem;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        #form,
        #form-search {
            background: rgba(0, 0, 0, 0.15);
            padding: 0.25rem;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            height: 3rem;
            box-sizing: border-box;
            backdrop-filter: blur(10px);
        }

        #form-search {
            top: 0;
        }

        #input,
        #search {
            border: none;
            padding: 0 1rem;
            flex-grow: 1;
            border-radius: 2rem;
            margin: 0.25rem;
        }

        #input:focus,
        #search:focus {
            outline: none;
        }

        #form>button,
        #form-search>button {
            background: #333;
            border: none;
            padding: 0 1rem;
            margin: 0.25rem;
            border-radius: 3px;
            outline: none;
            color: #fff;
        }

        #messages {
            list-style-type: none;
            margin: 48px 0 0;
            padding: 0;
        }

        #messages>li {
            padding: 0.5rem 1rem;
            cursor: pointer;
        }

        #messages>li:nth-child(odd) {
            background: #efefef;
        }

        #img-screen {
            position: fixed;
            width: 300px;
            border: darkgray 2px solid;
            right: 0;
            bottom: 48px;
            min-height: 180px;
            background-color: lightgray;
        }
    </style>
</head>

<body>
    <div id="form-search" action="">
        <input id="search" onkeyup="onSearch(this.value)" />
        <button id="btn-refresh">Refresh</button>
    </div>
    <img id="img-screen" alt="Bitte hier drÃ¼cken!"></img>
    <ul id="messages"></ul>
    <div id="form" action="">
        <input id="input" disabled="true" />
        <button id="btn-start">Start</button>
        <button id="btn-left">Left</button>
        <button id="btn-right">Right</button>
        <button id="btn-stop">End</button>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        socket.emit("#file-list", selectedId);

        var messages = document.getElementById('messages');
        var input = document.getElementById('input');

        var events = [
            ["btn-start", "#start"],
            ["btn-left", "#left"],
            ["btn-right", "#right"],
            ["btn-stop", "#stop"],
            ["img-screen", "#screen"],
            ["btn-refresh", "#file-list"],
        ];

        var selectedId = null;

        events.forEach(function (item) {
            var ele = document.getElementById(item[0]);
            ele.addEventListener('click', function (e) {
                //e.preventDefault();
                socket.emit(item[1], selectedId);
            });
        });


        var onClickItem = function (e) {
            selectedId = e.currentTarget.id;
            input.value = e.currentTarget.getInnerHTML();
        };

        var fileList = null;

        socket.on('fileList', function (msg) {
            messages.innerHTML = '';
            search.value = '';
            fileList = msg;
            fileList.forEach((file) => {
                var item = document.createElement('li');
                item.textContent = file.filename;
                item.id = file.hash;
                item.addEventListener('click', onClickItem);
                messages.appendChild(item);
            });
        });

        var onSearch = function (filterText) {
            filterText = filterText.toLowerCase();
            var lis = messages.children;
            for (var x = 0; x < lis.length; x++) {
                if (filterText === '' || lis[x].innerHTML.toLowerCase().indexOf(filterText) > -1) {
                    lis[x].removeAttribute('hidden');
                } else {
                    lis[x].setAttribute('hidden', true);
                }
            }
        }

        socket.on('image', function (img) {
            let img_screen = document.getElementById('img-screen');
            const blob = new Blob([img[0]]);
            const url = URL.createObjectURL(blob);
            img_screen.src = url;
        });
    </script>
</body>

</html>